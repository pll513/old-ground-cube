<body class="bg-darkGray">
<div class="container">
  <div data-role="dialog" id="dialog" data-close-button="true" data-overlay="true" data-overlay-color="op-dark"
       data-overlay-click-close="true">
    <div class="image-container image-format-square" style="width: 640px;">
      <div class="frame">
        <div
            style="width: 100%; height: 360px; background-image: url('/images/test/08.jpg'); background-size: cover; background-repeat: no-repeat; border-radius: 0px;position: relative;">
          <div style="position: absolute; right: 0; bottom: 0;">
            <span class="mif-download2"></span>
            <span>80</span>
            <span class="mif-heart"></span>
            <span>102</span></div>
        </div>
      </div>
    </div>
    <p>
      这是一个建筑。
    </p>
    <p>贡献者：<a href="#">pll513</a></p>
    <div style="text-align: center">
      <input type="button" value="小">
      <input type="button" value="中">
      <input type="button" value="大">
    </div>
  </div>
  <header class="margin20 no-margin-left no-margin-right">
    <div class="clear-float">
      <div class="place-right">
        <form style="font-size: 0">
          <div class="input-control text margin20" style="width: 300px">
            <input type="text" name="q" placeholder="搜索图片..." style="font-size: 16px;">
            <button class="button"><span class="mif-search"></span></button>
          </div>
          <button class="button"><span class="mif-image"></span></button>
        </form>
      </div>
      <a class="place-left" href="#" title="">
        <h1>图片库</h1>
      </a>
    </div>
    
    <div class="main-menu-wrapper">
      <ul id="nav-cate" class="horizontal-menu fg-grayLight" style="margin-left: -20px">
        <li><a href="#" data-category="animal" class="cate__item">动物</a></li>
        <li><a href="#" data-category="plant" class="cate__item">植物</a></li>
        <li><a href="#" data-category="human" class="cate__item">人</a></li>
        <li><a href="#" data-category="fodd" class="cate__item">食物</a></li>
        <li><a href="#" data-category="landscape" class="cate__item">风景</a></li>
        <li><a href="#" data-category="comic" class="cate__item">动漫</a></li>
        <li><a href="#" data-category="architecture" class="cate__item fg-grayLighter">建筑</a></li>
        <li><a href="#" data-category="science" class="cate__item">科技</a></li>
      </ul>
    </div>
  </header>
  <div class="tile-container" id="picture-list">
  
  </div>
</div>
<script>
  
  // 图片查询
  (function (w, d) {
    
    var currentCategory = 'animal';
    var divPictureList = d.getElementById('picture-list');
    var currentPageIndex = 0;
    var pageSize = 24;
    
    var navCate = d.getElementById('nav-cate');
    navCate.addEventListener('click', function (event) {
      event.preventDefault();
      var target = event.target;
      var category;
      if (~target.className.indexOf('cate__item')) {
        category = target.getAttribute('data-category');
        if (currentCategory !== category) {
          changeCategory(category);
          fetchPictures(category, currentPageIndex + 1, pageSize);
        }
      }
    });
    
    function changeCategory(newCate) {
      $('.active', navCate).removeClass('active');
      $('[data-category=' + newCate + ']').addClass('active');
      currentCategory = newCate;
    }
    
    function fetchPictures(cate, pageIndex, pageSize) {
      $.ajax({
        method: 'POST',
        url: '/pictures/pictureList',
        data: {
          pageIndex: pageIndex,
          pageSize: pageSize,
          category: cate
        },
        success: function (res) {
          console.log(res);
          var pictureList = res.data || [];
          var i;
          var pictureListHtml = '';
          var pictureHtml;
          currentPageIndex += 1;
          for (i = 0; i < pictureList.length; ++i) {
            pictureHtml = '<a href="' + '/pictures/' + pictureList[i]._id + '" class="tile" data-role="tile" style="opacity: 1; transform: scale(1); transition: 0.3s;"> <div class="tile-content"> <div class="image-container image-format-square" style="width: 100%;"> <div class="frame"> <div style="width: 100%; height: 150px; background-image: url(' + pictureList[i].url + '); background-size: cover; background-repeat: no-repeat; border-radius: 0px;"></div> </div> </div> </div> </a>'
            pictureListHtml += pictureHtml;
          }
          $(divPictureList).append(pictureListHtml);
        },
        error: function (res) {
          console.log(res);
        }
      });
    }
    
    
  })(window, document);
  
  var pictureListContainer = $('.tile-container');
  pictureListContainer.delegate('.tile', 'click', function (event) {
    metroDialog.toggle('#dialog');
  });
</script>
</body>